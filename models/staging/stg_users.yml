version: 2

models:
    - name: stg_users
      columns:
        - name: user_id
          description: Primary key for users.
          tests:
            - unique
            - not_null

        - name: plan
          description: "{{ doc('subscription_codes') }}"

        - name: sector_code
          description: Sector code (see data/seed_new_sector_codes.csv and data/seed_old_sector_codes.csv).

        - name: sector
          description: Sector (see data/seed_new_sector_codes.csv and data/seed_old_sector_codes.csv).
          tests:
            - not_null

        - name: broad_sector
          description: Broad categories for sector (see data/seed_new_sector_codes.csv and data/seed_old_sector_codes.csv).
          tests:
            - not_null

        - name: role_code
          description: Role code (see data/seed_new_role_codes.csv and data/seed_old_role_codes.csv).

        - name: role
          description: Role (see data/seed_new_role_codes.csv and data/seed_old_role_codes.csv).
          tests:
            - not_null

        - name: broad_role
          description: Broad categories for role based on broad_sector (see create_broad_role_field macro).
          tests:
            - not_null

        - name: country
          description: Country (ISO code).

        - name: country_name
          description: Name of the country correspondent to the ISO code.

        - name: email
          description: Email account (same as username).

        - name: nickname
          description: User nickname in genially.

        - name: language
          description: Language the Genially web interface is in.

        - name: about_me
          description: Short description about the user (user defined).

        - name: facebook_account
          description: Link to Facebook account.

        - name: twitter_account
          description: Link to Twitter account.

        - name: youtube_account
          description: Link to YouTube account.

        - name: instagram_account
          description: Link to Instagram account.

        - name: linkedin_account
          description: Link to LinkedIn account.

        - name: social_profile_name
          description: Social Profiles alias & URL.

        - name: is_validated
          description: Whether the user has validated their account.

        - name: is_social_profile_active
          description: Whether the user's social profile is active or not.
          tests:
            - not_null

        - name: registered_at
          description: Registration date.

        - name: last_access_at
          description: Last access date.

      tests:
        - dbt_utils.expression_is_true:
            expression: "broad_sector = sector"
            condition: "broad_sector = '{{ var('not_selected') }}'
              or sector = '{{ var('not_selected') }}'"
