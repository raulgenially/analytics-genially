version: 2

models:
    - name: users
      columns:
        - name: user_id
          description: Primary key for users.
          tests:
            - unique
            - not_null

        - name: plan
          description: "{{ doc('subscription_codes') }}"
          tests:
            - not_null
            - accepted_values:
                values: "{{ get_plan_values() }}"

        - name: sector
          description: Sector (see data/seed_new_sector_codes.csv and data/seed_old_sector_codes.csv).
          tests:
            - not_null

        - name: broad_sector
          description: Broad categories for sector (see data/seed_new_sector_codes.csv and data/seed_old_sector_codes.csv).
          tests:
            - not_null

        - name: role
          description: Role (see data/seed_new_role_codes.csv and data/seed_old_role_codes.csv).
          tests:
            - not_null

        - name: broad_role
          description: Broad categories for role based on broad_sector (see create_broad_role_field macro).
          tests:
            - not_null

        - name: country
          description: Country (ISO code).
          tests:
            - not_null

        - name: country_name
          description: Full name of the country.
          tests:
            - not_null

        - name: email
          description: Email account (same as username).
          tests:
            - not_null

        - name: nickname
          description: User NickName in Genially.

        - name: language
          description: Language the Genially web interface is in.

        - name: about_me
          description: Short description about the user (user defined).

        - name: facebook_account
          description: Link to Facebook account.

        - name: twitter_account
          description: Link to Twitter account.

        - name: youtube_account
          description: Link to YouTube account.

        - name: instagram_account
          description: Link to Instagram account.

        - name: linkedin_account
          description: Link to LinkedIn account.

        - name: social_profile_name
          description: Social Profiles alias & URL.

        - name: n_total_creations
          description: Total number of creations (including those that have been removed).
          tests:
            - not_null

        - name: n_active_creations
          description: Total number of active creations, that is, creations that have not been removed.
          tests:
            - not_null

        - name: n_active_creations_in_personal_ws
          description: Total number of active creations in personal workspace (excluding creations in the context of Teams).
          tests:
            - not_null

        - name: n_published_creations
          description: Total number of published creations (including those that have been removed).
          tests:
            - not_null

        - name: n_published_creations_as_collaborator
          description: Total number of collaborative published creations (including those that have been removed) where the user is not the owner.
          tests:
            - not_null

        - name: n_active_published_creations
          description: Total number of published creations that are active.
          tests:
            - not_null

        - name: n_active_collaborative_published_creations
          description: Total number of collaborative published creations that are active.
          tests:
            - not_null

        - name: n_creations_in_social_profile
          description: Total number of creations that have been published in user's social profile at some point.
            Note that the user's social profile might not be currently active (see is_social_profile_active field).
          tests:
            - not_null

        - name: n_active_creations_in_social_profile
          description: Total number of creations that have been published in user's social profile and are active.
            Note that the user's social profile might not be currently active (see is_social_profile_active field).
          tests:
            - not_null

        - name: n_active_reusable_creations_in_social_profile
          description: Total number of reusable creations included in the social profile that are active.
            Note that the user's social profile might not be currently active (see is_social_profile_active field).
          tests:
            - not_null

        - name: is_validated
          description: Whether the user has validated their account.
          tests:
            - not_null

        - name: is_social_profile_active
          description: Whether the user's social profile is active or not.
          tests:
            - not_null

        - name: is_in_collaboration
          description: Whether the user forms part of a collaboration (active or not). The user might be or not the owner.
          tests:
            - not_null

        - name: is_in_collaboration_of_published_creation
          description: Whether the user forms part of a collaboration (active or not) that has been published at some point. The user might be or not the owner.
          tests:
            - not_null

        - name: is_in_collaboration_of_creation_in_social_profile
          description: Whether the user forms part of a collaboration (active or not) that has been published in owner's social profile at some point. The user might be or not the owner.
            This field can be only true for owners with social profile active.
          tests:
            - not_null

        - name: has_creation_visualized_last_90_days
          description: Whether the user has a genially visualized within the last 90 days.
          tests:
            - not_null

        - name: has_creation_visualized_last_60_days
          description: Whether the user has a genially visualized within the last 60 days.
          tests:
            - not_null

        - name: has_creation_visualized_last_30_days
          description: Whether the user has a genially visualized within the last 30 days.
          tests:
            - not_null

        - name: is_in_collaboration_of_creation_visualized_last_90_days
          description: Whether the user forms part of a collaboration (active or not) that has been visualized within the last 90 days.
          tests:
            - not_null

        - name: is_in_collaboration_of_creation_visualized_last_60_days
          description: Whether the user forms part of a collaboration (active or not) that has been visualized within the last 60 days.
          tests:
            - not_null

        - name: is_in_collaboration_of_creation_visualized_last_30_days
          description: Whether the user forms part of a collaboration (active or not) that has been visualized within the last 30 days.
          tests:
            - not_null

        - name: registered_at
          description: Registration date.

        - name: last_access_at
          description: Last access date.

      tests:
        - dbt_utils.expression_is_true:
            expression: "country_name = '{{ var('not_selected') }}'"
            condition: "country = '{{ var('not_selected') }}'"

        - dbt_utils.expression_is_true:
            expression: "n_active_creations <= n_total_creations"

        - dbt_utils.expression_is_true:
            expression: "has_creation_visualized_last_30_days = false
              and has_creation_visualized_last_60_days = false
              and has_creation_visualized_last_90_days = false"
            condition: "n_total_creations = 0"
