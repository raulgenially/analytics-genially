version: 2

models:
  - name: metrics_users_and_creations_by_month
    description: Model containing metrics related to users and creations aggregated by month.
     This model has been built using a reference table (macro get_combination_calendar_dimensions) with all posible
     combinations of the dimensions.
    columns:
      - name: date_month
        description: The first day of the month where metrics are described.
        tests:
          - not_null

      - name: plan
        description: "{{ doc('subscription_codes') }}"
        tests:
          - not_null
          - accepted_values:
              values: "{{ get_plan_values() }}"

      - name: subscription
        description: Type of subscription, Free or Premium.
        tests:
          - not_null
          - accepted_values:
              values: "{{ get_subscription_values() }}"

      - name: country
        description: Country (ISO code).
        tests:
          - not_null

      - name: country_name
        description: Full name of the country.
        tests:
          - not_null

      - name: broad_sector
        description: Broad categories for sector (see data/seed_new_sector_codes.csv and data/seed_old_sector_codes.csv).
        tests:
          - not_null

      - name: broad_role
        description: Broad categories for role based on broad_sector (see create_broad_role_field macro).
        tests:
          - not_null

      - name: n_active_users
        description: Numbers of active users during that month.
        tests:
          - not_null

      - name: n_signups
        description: Numbers of users registered during that month.
        tests:
          - not_null

      - name: n_creations
        description: Numbers of geniallys created during that month.
        tests:
          - not_null


    tests:
      - dbt_utils.expression_is_true:
          expression: "n_signups <= n_active_users"
