version: 2

models:
    - name: src_genially_users
      description: Registered users.
      columns:
        - name: user_id
          description: Primary key for users.
          tests:
            - unique
            - not_null

        - name: subscription_plan
          description:  "{{ doc('subscription_codes') }}"
          tests:
            - not_null
            - accepted_values:
                values: "{{ get_plan_values() }}"

        - name: sector_code
          description: Sector code (see data/seed_new_sector_codes.csv and data/seed_old_sector_codes.csv).

        - name: role_code
          description: Role code (see data/seed_new_role_codes.csv and data/seed_old_role_codes.csv).

        - name: username
          description: Username.

        - name: nickname
          description: Nickname.

        - name: email
          description: Email account (same as username).
          tests:
            - not_null

        - name: country
          description: Country (ISO code).
          tests:
            - not_null
            - relationships:
                to: ref('seed_country_codes')
                field: code
                where: country != '{{ var('not_selected') }}'

        - name: city
          description: City.

        - name: logins
          description: Logins in the application using third-party services such as Google, Facebook, etc.

        - name: language
          description: Language.

        - name: organization
          description: Organization.

        - name: facebook_account
          description: Link to Facebook account.

        - name: twitter_account
          description: Link to Twitter account.

        - name: youtube_account
          description: Link to YouTube account.

        - name: instagram_account
          description: Link to Instagram account.

        - name: linkedin_account
          description: Link to LinkedIn account.

        - name: email_validation_token
          description: Token used to validate the email.

        - name: email_validation_created_at
          description: Date the validation email was sent.

        - name: about_me
          description: Short description about the user (user defined).

        - name: is_validated
          description: Whether the user has validated their email.
          tests:
            - not_null

        - name: analytics_id
          description: Foreign key referring to web analytics data.

        - name: registered_at
          description: Registration date.

        - name: last_access_at
          description: Last access date.

      tests:
      - dbt_utils.expression_is_true:
          expression: "last_access_at >= registered_at"
          condition: "registered_at > '2020-09-11'"
