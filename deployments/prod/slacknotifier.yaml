apiVersion: cloud-build-notifiers/v1
kind: SlackNotifier
metadata:
  name: Slack Production Failed Build Notifier
spec:
  notification:
    # 3997b276-348f-48c2-9b47-58d31194db89 -> analytics-prod
    # 0ae65eb4-b177-457d-999f-d0268838a380 -> analytics-docs
    filter: (
        build.build_trigger_id == "3997b276-348f-48c2-9b47-58d31194db89"
        && build.status in [Build.Status.FAILURE, Build.Status.TIMEOUT, Build.Status.SUCCESS]
      )
      || (
        build.build_trigger_id == "0ae65eb4-b177-457d-999f-d0268838a380"
        && build.status in [Build.Status.FAILURE, Build.Status.TIMEOUT]
      )
    delivery:
      webhookUrl:
        secretRef: webhook-url
  secrets:
  - name: webhook-url
    value: projects/data-genially/secrets/cloud-build-slack-webhook/versions/latest
